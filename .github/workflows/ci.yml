# This workflow name will be displayed in the GitHub Actions UI.
name: Go CI

# This section defines when the workflow will be triggered.
on:
  # Trigger the workflow on push events to the 'main' branch.
  push:
    branches: [ main ]
  # Trigger the workflow on pull request events targeting the 'main' branch.
  pull_request:
    branches: [ main ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel.
jobs:
  # This workflow contains a single job called "build".
  build:
    # The type of runner that the job will run on.
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job.
    steps:
      # Step 1: Check out your repository under $GITHUB_WORKSPACE, so your job can access it.
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Set up the Go programming language environment.
      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          # Use a Go version compatible with your go.mod file.
          go-version: '1.24.x'

      # Step 3: Install project dependencies. 'go mod tidy' ensures the go.mod and go.sum files are consistent.
      - name: Install dependencies
        run: go mod tidy

      # Step 4: Run the linter to enforce code style and catch common issues.
      # - name: Run linter
      #   uses: golangci/golangci-lint-action@v6
      #   with:
      #     version: v1.59

      # Step 5: Run the tests for all packages in the repository. The '-v' flag provides verbose output.
      - name: Run tests
        run: go test -v ./...

      # Step 6: Build the application to ensure it compiles successfully.
      - name: Build application
        run: go build -v -o go-github-actions-ci .